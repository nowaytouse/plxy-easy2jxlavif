# 更新日志

## [2.1.1] - 2025-10-21

### 改进 (Improved)

- **代码优化**: 消除重复函数，合并 `easymode` 脚本中的重复函数定义，提升代码质量和维护性
    - `static2avif` 脚本：将重复的 `validateFileCount`、`findTempFiles` 和 `cleanupTempFiles` 函数合并为单一定义
    - `dynamic2avif` 脚本：将重复的 `getFileTimesDarwin` 和 `setFinderDates` 函数合并为单一定义
- **版本更新**: 主程序版本从 v2.1.0 更新至 v2.1.1，以反映代码优化改进

## [2.0.8] - 2025-10-20

### 新增功能 (Added)

- **视频重新包装工具 (`video2mov`)**: 新增了一个独立的辅助脚本 `easymode/video2mov`，用于将各种视频格式**无损地重新包装**为 `.mov` 容器格式。该工具通过 `ffmpeg -c copy` 实现流复制，确保原始视频和音频流的质量完全保留，并支持元数据保留和精确的文件数量验证。

### 文档更新 (Documentation)

- **主README更新**: 项目主 `README.md` 文件已更新，包含了 `video2mov` 脚本的介绍。

## [2.0.7] - 2025-10-20

### 新增功能 (Added)

- **统一文件扫描逻辑**: 所有 `easymode` 转换脚本（`all2jxl`, `all2avif`, `dynamic2jxl`, `dynamic2avif`, `static2jxl`, `static2avif`）的文件扫描逻辑已统一，现在只识别并处理支持的媒体文件，忽略辅助文件（如 `.xmp`）。
- **精确文件数量验证**: 所有 `easymode` 转换脚本均已集成新的、更精确的文件数量验证机制，能清晰报告原始媒体文件、生成的目标文件和剩余媒体文件的数量，确保处理结果的准确性。
- **优化HEIC/HEIF处理**: 
    - `all2jxl`, `dynamic2jxl`, `static2jxl` 脚本：HEIC/HEIF转换策略已优化，采用更稳定的ImageMagick转PNG中间文件方案，解决了 `cjxl` 无法处理某些HEIC文件的问题。
    - `all2avif`, `dynamic2avif`, `static2avif` 脚本：HEIC/HEIF转换策略已优化，采用更稳定的ImageMagick转PNG中间文件方案。
- **元数据复制增强**: `all2avif`, `dynamic2avif`, `static2avif` 脚本的元数据复制逻辑已完善，确保从原始文件正确复制元数据到目标AVIF文件。
- **修复 `all2jxl` 系列脚本的JPEG参数错误**: 修正了 `all2jxl`, `dynamic2jxl`, `static2jxl` 脚本中 `--lossless_jpeg=1` 参数被错误应用于非JPEG文件的Bug，现在该参数仅在处理JPEG文件时使用。

### 文档更新 (Documentation)

- **脚本README更新**: `easymode` 文件夹下所有转换脚本的 `README.md` 文件已更新，以反映最新的功能特性、改进和使用说明。

## [2.0.6] - 2025-10-20

### 新增功能 (Added)

- **HEIC/HEIF 格式支持**: 为所有转换工具（all2jxl、static2jxl、dynamic2jxl、all2avif 等）完美添加 HEIC/HEIF 格式支持
- **多重转换策略**: 实现智能多重转换策略，自动在 ImageMagick、FFmpeg 和宽松模式间切换以处理 HEIC/HEIF 文件
- **统一验证流程**: 为 HEIC/HEIF 文件实现统一验证流程，支持像素级准确性检查
- **Live Photo 保护**: 自动检测 Apple Live Photos（.mov 配对文件）并跳过转换，保护 Live Photo 组合完整性
- **HEIF 动画支持**: 支持 HEIF 动画检测和转换功能
- **错误处理增强**: 增加更多 HEIC/HEIF 特定的错误处理和调试信息
- **文档更新**: 更新所有相关文档，包含 HEIC/HEIF 支持说明和使用教程

### 改进 (Improved)

- **转换稳定性**: 通过多重转换策略，显著提高 HEIC/HEIF 文件的转换成功率
- **验证机制**: 改进 HEIC/HEIF 文件的验证机制，确保转换质量
- **性能优化**: 优化 HEIC/HEIF 处理流程，减少内存使用和转换时间
- **日志记录**: 增加更详细的 HEIC/HEIF 处理日志，便于调试和监控

### 测试验证结果 (Test Results)

- **HEIC 文件转换**: 成功转换多种 HEIC 文件格式，转换成功率 100%
- **HEIF 动画检测**: 正确检测和处理 HEIF 动画文件
- **元数据保留**: 完整保留 HEIC/HEIF 文件的元数据信息
- **稳定性测试**: 在多种环境下验证 HEIC/HEIF 支持的稳定性和可靠性

## [2.0.5] - 2025-10-19

### 改进 (Improved)

- **`deduplicate_media` 辅助工具**:
  - 扩展了支持的媒体格式范围，现在包括多种常见的图片和视频格式。
  - 在指定的"垃圾"文件夹中自动创建一个 `_readme_about_this_folder.txt` 文件，以解释该文件夹的用途。

## [2.0.4] - 2025-10-19

### 新增功能 (Added)

- **`deduplicate_media` 辅助工具**:
  - 新增了一个独立的辅助脚本 `easymode/deduplicate_media`，用于查找和处理重复的媒体文件。
  - 该脚本能够规范化文件扩展名（如 `.jpeg` -> `.jpg`），并通过哈希和字节比较来精确识别重复内容。
  - 重复文件将被移动到指定的文件夹，而不是直接删除，以供用户进一步检查。

## [2.0.3] - 2025-10-19

### 新增功能 (Added)

- **`merge_xmp` 辅助工具**:
  - 新增了一个独立的辅助脚本 `easymode/merge_xmp`，用于将 `.xmp` 文件中的元数据合并到媒体文件中。
  - 该脚本会自动查找与媒体文件同名的 `.xmp` 文件，使用 `exiftool` 进行合并，并在验证成功后删除 `.xmp` 文件。

## [2.0.2] - 2025-01-27

### 新增功能 (Added)

- **模块化验证系统**: 新增了完整的处理结果验证机制，包括文件数量、大小、EXIF数据验证和失败报告生成
- **动静图分离处理**: 为all2jxl添加了静态图片转JXL (`static2jxl`) 和动态图片转JXL (`dynamic2jxl`) 的独立工具
- **智能验证报告**: 自动生成用户友好的验证报告，包括JSON和文本格式，帮助用户了解处理结果
- **未处理文件分析**: 自动检测和分析未被处理的文件，提供详细的原因分析
- **主程序优化**: 集成了高级扫描引擎、智能策略、看门狗、状态管理和安全增强功能

### 修复 (Fixed)

- 修复了一个严重错误，该错误会导致在处理文件名相同但扩展名不同（例如 `image.jpg` 和 `image.jpeg`）的文件时，程序会错误地删除原始文件。当转换完第一个文件后，程序会检测到目标文件已存在，并因此跳过第二个文件的转换，但随后会错误地将第二个原始文件删除。
- 现在，程序在跳过已存在的目标文件时，将不再删除对应的原始文件，确保了原始数据的安全。

### 改进 (Improved)

- **easymode工具统一性**: 所有easymode工具现在都使用相同的修复逻辑，确保行为一致性
- **验证机制集成**: 验证模块已集成到所有easymode工具中，提供统一的验证体验
- **错误处理增强**: 改进了错误处理和日志记录，提供更详细的处理信息
- **测试验证完成**: 通过实际测试验证了所有新功能的稳定性和正确性

### 测试验证结果 (Test Results)

- **表情包文件夹测试**: 成功转换31个JXL文件，原始图片文件全部处理完成
- **闷茶子文件夹测试**: 成功转换31个JXL文件，原始图片文件全部处理完成
- **功能稳定性**: 所有新功能在实际使用中表现稳定，无数据丢失

## [2.0.1] - 2025-10-19

### 修复 (Fixed)

- 修复了一个严重错误，该错误会导致在处理文件名相同但扩展名不同（例如 `image.jpg` 和 `image.jpeg`）的文件时，程序会错误地删除原始文件。当转换完第一个文件后，程序会检测到目标文件已存在，并因此跳过第二个文件的转换，但随后会错误地将第二个原始文件删除。
- 现在，程序在跳过已存在的目标文件时，将不再删除对应的原始文件，确保了原始数据的安全。