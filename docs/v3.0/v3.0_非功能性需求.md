# Pixly v3.0 - 非功能性需求与用户体验标准

**创建日期**: 2025-10-25  
**重要性**: ⭐⭐⭐⭐⭐ 与核心算法同等重要

---

## 🎯 核心理念

Pixly不仅仅是一个"转换工具"，更是一个**精致的用户体验产品**。

> **项目标准**：性能与美学并重，技术与体验统一

---

## 📋 必须保留的用户体验特性

### 1. 🎮 精致的可交互CLI

#### 方向键菜单系统（完全保留）

**最初版本实现**（已验证优秀）：

```go
// arrow_menu.go - 方向键导航系统
type ArrowMenuOption struct {
    Icon        string    // 🔄 📂 🧪 等emoji图标
    Text        string    // 选项文本
    Description string    // 详细说明
    Enabled     bool      // 是否可选
}

操作方式：
  ↑/↓  - 上下移动选择
  W/S  - 备用方向键（游戏风格）
  Enter - 确认选择
  Q/B  - 退出/返回

设计哲学：
  ✓ 统一使用方向键+回车，消除数字输入特殊情况
  ✓ 好品味：不使用数字键选择（老派CLI）
  ✓ 现代化：类似GUI的键盘导航
```

**实际效果**：

```
  ╔══════════════════════════════════════════════╗
  ║  📋 Pixly 转换模式选择  ║
  ╚══════════════════════════════════════════════╝

  🟦 1️⃣  🚀 Auto+模式（智能优化）
      │  最智能的转换模式，自动选择最佳参数
      └─ 推荐用于日常使用
  
  ⬜ 2️⃣  📊 分析模式（仅分析）
      │  不进行转换，仅分析文件特征
      └─ 用于测试和预测
  
  ⬜ 3️⃣  ⚙️  高级设置
      │  自定义转换参数
      └─ 专业用户使用

  🎮 操作: ↑/↓ 选择, Enter 确认, q/b 退出
```

**v3.0改进**：
- ✓ 完全保留方向键菜单系统
- ✓ 保留emoji图标系统
- ✓ 简化菜单选项（删除Quality/Emoji模式）
- ➕ 新增"预测模式"选项（显示预测结果但不转换）

---

### 2. 🎨 现代化美观的UI

#### 动态进度条（完全保留）

**最初版本实现**（基于pterm库）：

```go
// progress_dynamic.go - 彩色动画进度条
progressBar.BarStyle = &pterm.Style{pterm.FgLightBlue, pterm.BgDefault}
progressBar.TitleStyle = &pterm.Style{pterm.FgLightCyan, pterm.Bold}
progressBar.BarCharacter = "█"
progressBar.LastCharacter = "█"

特性：
  ✓ 彩色进度条（蓝色渐变）
  ✓ 实时速度显示（文件/秒）
  ✓ 剩余时间估算
  ✓ 平滑动画效果
  ✓ 多进度条支持（扫描+转换同时显示）
```

**实际效果**：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📁 扫描文件中...
  [████████████████████████████░░░░░░░░] 720/990
  ⚡ 15.2 files/s | ⏱️  已用 47s | ⏳ 剩余 18s

🔄 转换处理中... [PNG→JXL无损]
  [█████████████████████░░░░░░░░░░░░░░░] 512/720
  ⚡ 8.5 files/s | 💾 已节省 1.2GB | 📊 平均85%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**v3.0改进**：
- ✓ 保留动态进度条
- ➕ 新增"预测进度"指示器
- ➕ 显示预测准确率统计
- ➕ 显示探索触发次数

#### Emoji和Unicode支持（完全保留）

```go
// emoji_layout.go - Unicode emoji系统
支持的emoji：
  转换状态: 🔄 ✅ ❌ ⚠️ ⏭️
  文件类型: 🖼️ 🎬 🎨 📷 🎭
  操作提示: 🎮 📋 ⚙️ 🚀 📊
  质量指示: 💎 ⭐ 🌟 ✨

设计原则:
  ✓ 使用Unicode原生emoji（不依赖字体）
  ✓ 提供降级方案（ASCII模式）
  ✓ 支持自定义emoji风格
```

#### ASCII艺术（保留并优化）

```go
// ascii_art.go - 启动画面
  ██████╗ ██╗██╗  ██╗██╗  ██╗   ██╗
  ██╔══██╗██║╚██╗██╔╝██║  ╚██╗ ██╔╝
  ██████╔╝██║ ╚███╔╝ ██║   ╚████╔╝ 
  ██╔═══╝ ██║ ██╔██╗ ██║    ╚██╔╝  
  ██║     ██║██╔╝ ██╗███████╗██║   
  ╚═╝     ╚═╝╚═╝  ╚═╝╚══════╝╚═╝   
  
  v3.0 - Parameter Intelligence Engine
  智能参数预测 | 现代格式优化
```

**v3.0改进**：
- ✓ 保留ASCII艺术启动画面
- ➕ 添加版本标识（v3.0）
- ➕ 添加核心理念副标题

---

### 3. ⚙️ 复杂详细的配置系统

#### YAML配置文件（完全保留并扩展）

**最初版本结构**（172行，非常详细）：

```yaml
# .pixly.yaml - 主配置文件
conversion:
  default_mode: auto+           # v3.0仅此模式
  quality:                      # 质量阈值（保留）
    avif_quality: 75
    jxl_quality: 85
    video_crf: 23
  supported_extensions:         # 白名单（保留）
    - .jpg
    - .png
    - .gif
    # ... 20+种格式

concurrency:                    # 并发控制（保留并优化）
  auto_adjust: true
  conversion_workers: 4
  memory_limit: 8192
  scan_workers: 8

output:                         # 输出设置（保留）
  directory_template: ""        # 空=原地转换
  filename_template: ""
  generate_report: true
  keep_original: false

problem_file_handling:          # 问题文件处理（保留）
  corrupted_file_strategy: ignore
  codec_incompatibility_strategy: ignore
  trash_file_strategy: delete

security:                       # 安全设置（完全保留）
  check_disk_space: true
  forbidden_directories:
    - /System
    - /Library
    # ... macOS系统目录保护
  max_file_size: 1002400        # 1GB

theme:                          # UI主题（保留）
  emoji_style: custom
  enable_ascii_art_colors: true
  enable_emoji: true
  mode: dark

tools:                          # 工具路径（保留）
  avifenc_path: /opt/homebrew/bin/avifenc
  cjxl_path: /opt/homebrew/bin/cjxl
  exiftool_path: /opt/homebrew/bin/exiftool
  ffmpeg_path: /opt/homebrew/bin/ffmpeg
  ffprobe_path: /opt/homebrew/bin/ffprobe
```

**v3.0新增配置**：

```yaml
# 新增：智能预测配置
prediction:
  enabled: true                   # 启用智能预测
  confidence_threshold: 0.80      # 触发探索的阈值
  lookup_table_path: ""          # 自定义查找表
  enable_learning: true          # 启用学习系统
  history_file: ".pixly_history.json"

# 新增：中质量探索配置
exploration:
  enabled: true                  # 启用探索（低置信度时）
  max_candidates: 3              # 最多探索候选数
  parallel_explore: true         # 并行探索
  
# 新增：知识库配置
knowledge_base:
  enabled: true
  path: ".pixly_kb.json"
  auto_update: true
  min_samples: 100               # 最少样本数才启用预测模型

# 保留并简化：删除quality_mode和emoji_mode相关配置
```

#### 配置验证与迁移

```go
// config/migration.go - 配置版本迁移
func MigrateV1ToV3(oldConfig *ConfigV1) *ConfigV3 {
    newConfig := &ConfigV3{}
    
    // 删除已废弃的模式配置
    // oldConfig.Conversion.Modes -> 删除
    
    // 保留核心配置
    newConfig.Conversion.Quality = oldConfig.Conversion.Quality
    newConfig.Concurrency = oldConfig.Concurrency
    newConfig.Security = oldConfig.Security
    
    // 新增默认预测配置
    newConfig.Prediction = DefaultPredictionConfig()
    
    return newConfig
}
```

---

### 4. 🎯 交互方式标准

#### 输入模式（统一方向键）

**禁止的交互方式**：
- ❌ 数字键选择菜单（老派CLI）
- ❌ 单字母快捷键菜单（易误操作）
- ❌ 鼠标点击（不适合CLI）

**允许的交互方式**：
- ✅ ↑/↓ + Enter（主要方式）
- ✅ W/S + Enter（备用，游戏风格）
- ✅ Q/B 退出（通用）
- ✅ Tab补全（文件路径）

**设计哲学**：

```
一致性 > 灵活性
简单性 > 功能性
可预测 > 可定制

用户应该在3秒内明白如何操作，
而不是阅读10行帮助文本。
```

#### 错误处理与提示

```go
// 好的错误提示（保留）
❌ 文件损坏: photo.jpg
   ├─ 原因: JPEG头部不完整
   ├─ 建议: 使用图像修复工具
   └─ 操作: 已跳过此文件

// 坏的错误提示（避免）
Error: File corrupted
```

---

### 5. 🏃 性能要求

#### 响应时间标准

```
操作类型           | 最大延迟  | 理想延迟
-------------------|----------|----------
菜单响应           | 100ms    | 50ms
特征提取           | 200ms    | 100ms
参数预测           | 100ms    | 50ms
进度条更新         | 500ms    | 200ms
配置加载           | 1s       | 500ms
```

#### 内存使用标准

```
场景               | 最大内存  | 理想内存
-------------------|----------|----------
空闲状态           | 50MB     | 30MB
处理100个文件      | 2GB      | 1GB
处理1000个文件     | 8GB      | 4GB
```

#### 并发控制（保留并优化）

```go
// concurrency/optimizer.go - 动态并发调整
type ConcurrencyOptimizer struct {
    maxWorkers      int
    currentWorkers  int
    memoryThreshold float64  // 0.75 = 75%
    cpuThreshold    float64  // 0.80 = 80%
}

自适应策略：
  - 内存使用 > 75% → 减少20%工作线程
  - CPU使用 > 80% → 减少15%工作线程
  - 资源空闲 < 60% → 增加10%工作线程
```

**v3.0改进**：
- ✓ 保留动态并发调整
- ✗ 删除过度复杂的网络监控
- ✗ 删除磁盘IOPS监控
- ✓ 保留内存和CPU监控

---

### 6. ✅ 测试集通关要求

#### TESTPACK验证（100%通过）

**来自最初版本的严格要求**：

```
TESTPACK PASSIFYOUCAN!/
├─ 要求1: 静态图片必须转为JXL ✓
├─ 要求2: 动态图片必须转为AVIF ✓
├─ 要求3: 必须正确识别静动图 ✓
├─ 要求4: 100%成功转换或正确跳过 ✓
├─ 要求5: 文件夹路径名完整保留 ✓
├─ 要求6: 无针对性和虚假代码 ✓
├─ 要求7: 平衡优化功能符合预期 ✓
├─ 要求8: 转换文件100%真实可信 ✓

通过标准：
  - 855个JPEG → 100%成功
  - 51个PNG → 100%成功
  - 48个GIF → 100%成功
  - 18个GIF动图 → 100%转AVIF
  - 复杂文件夹名 → 100%保留
  - Live Photo → 100%跳过
```

**v3.0额外测试**：

```
新增测试：预测准确率
  - PNG文件 → 预测准确率 >95%
  - 高质量JPEG → 预测准确率 >90%
  - 中等质量JPEG → 触发探索 <25%
  - 平均处理速度 → <5秒/文件

性能回归测试：
  - v1.0: 8-10秒/文件（基准）
  - v3.0: 4-6秒/文件（目标）
  - 提升: >40%
```

---

### 7. 🚀 后期GUI规划

#### CLI → GUI演进路线

**Phase 1: CLI优先（v3.0）**

```
当前: 100% CLI
目标: 精致的终端体验
工具: pterm, cobra, viper
```

**Phase 2: TUI过渡（v3.5，可选）**

```
技术: Bubble Tea (charm.sh)
特性:
  - 全屏终端UI
  - 鼠标支持
  - 窗口化布局
  - 实时预览
```

**Phase 3: GUI实现（v4.0，远期）**

```
技术栈选项:
  Option 1: Electron + React
    优点: 跨平台, 现代化, Web技术栈
    缺点: 体积大, 内存占用高
  
  Option 2: Wails + Vue
    优点: 轻量级, Go原生, 体积小
    缺点: 相对较新的技术
  
  Option 3: Fyne (纯Go)
    优点: 纯Go, 原生性能, 跨平台
    缺点: UI组件有限

推荐: Wails v2（平衡各方面）
```

**GUI功能预览**：

```
┌─────────────────────────────────────────────┐
│ Pixly v4.0 - 智能媒体转换工具               │
├─────────────────────────────────────────────┤
│                                             │
│  📁 拖拽文件或文件夹到此处                  │
│                                             │
│  或 [选择文件] [选择文件夹]                 │
│                                             │
├─────────────────────────────────────────────┤
│ 🎯 预测结果:                                │
│   PNG (360个) → JXL无损 (预计节省85%)      │
│   JPEG (320个) → JXL/AVIF混合 (预计节省25%) │
│   置信度: 92% ✓                             │
├─────────────────────────────────────────────┤
│ ⚙️ 设置:                                    │
│   ☑ 启用智能预测                           │
│   ☑ 原地转换                               │
│   ☑ 保留原文件                             │
├─────────────────────────────────────────────┤
│          [开始转换]  [取消]                 │
└─────────────────────────────────────────────┘
```

**设计原则**：
- ✅ GUI应该是CLI的增强，而非替代
- ✅ 所有GUI功能必须在CLI中有对应
- ✅ CLI优先开发，GUI后续跟进

---

## 🎨 UI/UX设计原则

### 1. 一致性原则

```
所有交互使用相同的模式：
  - 菜单 → ↑/↓ + Enter
  - 确认 → Enter
  - 取消 → Q/B
  - 帮助 → H/?

所有提示使用相同的格式：
  ✓ 成功 → ✅ 绿色
  ✗ 失败 → ❌ 红色
  ! 警告 → ⚠️  黄色
  i 信息 → ℹ️  蓝色
```

### 2. 反馈原则

```
用户的每个操作必须有明确反馈：
  - 按键 → 立即视觉变化
  - 操作 → 进度指示
  - 完成 → 结果摘要
  - 错误 → 清晰原因
```

### 3. 容错原则

```
提供撤销和恢复机制：
  - 转换前 → 显示预测结果
  - 转换中 → 支持暂停/恢复
  - 转换后 → 保留原文件（可选）
  - 错误时 → 自动回滚
```

### 4. 性能原则

```
UI永远不应该阻塞核心功能：
  - 进度条更新 → 异步
  - 日志输出 → 缓冲
  - 统计计算 → 后台
  - 配置加载 → 延迟
```

---

## 📦 依赖库标准

### CLI/TUI库（已验证）

```go
// 必须保留的库
"github.com/pterm/pterm"           // 进度条、表格、颜色
"github.com/spf13/cobra"           // 命令行框架
"github.com/spf13/viper"           // 配置管理
"go.uber.org/zap"                  // 日志系统

// 可选优化的库
"golang.org/x/term"                // 终端控制
"github.com/fatih/color"           // 颜色（pterm已包含）
```

### 禁止的设计模式

```go
❌ 避免：过度抽象
   // 坏例子：7层接口只为了打印一行文字
   type Printer interface {
       Print(string)
   }
   type ConsolePrinter struct { ... }
   type FilePrinter struct { ... }
   
   // 好例子：直接使用标准库
   fmt.Println("hello")

❌ 避免：配置过载
   // 坏例子：200+行配置，99%用不到
   theme:
     menu:
       border:
         top:
           left:
             corner:
               style: "rounded"
   
   // 好例子：合理默认值
   theme:
     mode: dark  # auto/light/dark

❌ 避免：隐藏控制流
   // 坏例子：魔法般的依赖注入
   @Inject
   var converter Converter
   
   // 好例子：明确的依赖
   converter := NewConverter(config, logger)
```

---

## ✅ v3.0实施清单

### 必须保留（100%）

- [x] 方向键菜单系统
- [x] 动态进度条（pterm）
- [x] Emoji和Unicode支持
- [x] ASCII艺术启动画面
- [x] YAML配置系统（172行）
- [x] 多语言支持（i18n）
- [x] 主题系统（dark/light）
- [x] 并发自适应优化
- [x] 安全目录保护
- [x] 问题文件处理
- [x] TESTPACK通关验证

### 必须改进

- [ ] 简化菜单选项（删除Quality/Emoji模式）
- [ ] 新增预测结果显示
- [ ] 新增置信度指示器
- [ ] 新增探索进度显示
- [ ] 新增知识库管理界面
- [ ] 优化配置文件注释
- [ ] 添加配置迁移工具

### 必须删除

- [x] Quality模式配置
- [x] Emoji模式配置
- [x] 过度复杂的性能监控（网络、磁盘IOPS）
- [x] 8种质量分类字符串

---

## 🎯 成功标准

### 用户体验

- ✅ 3秒内理解如何操作
- ✅ 每个操作<100ms响应
- ✅ 错误提示清晰易懂
- ✅ 进度实时可见

### 工程质量

- ✅ 配置文件完整且有注释
- ✅ 所有交互统一使用方向键
- ✅ UI永不阻塞核心功能
- ✅ 100%通过TESTPACK

### 性能表现

- ✅ 内存使用 < 2GB（1000文件）
- ✅ 并发自适应调整
- ✅ 进度条更新流畅
- ✅ 配置加载 < 500ms

---

## 📝 总结

**Pixly v3.0的用户体验承诺**：

1. **精致**：不是简单的CLI工具，而是精心设计的用户体验
2. **一致**：所有交互使用统一的模式（方向键+Enter）
3. **现代**：彩色动画、emoji、ASCII艺术
4. **灵活**：详细的配置系统，满足各种需求
5. **安全**：多层保护，防止误操作
6. **快速**：响应迅速，进度实时
7. **可靠**：100%通过测试集

**核心理念**：

> 性能优化是技术，用户体验是艺术。  
> Pixly v3.0 = 智能算法 + 精致体验

---

**参考文档**：
- 智能参数预测引擎_核心设计.md（算法设计）
- v3.0_执行摘要.md（快速总览）
- PIXLY最初版本/internal/ui/（UI实现参考）

