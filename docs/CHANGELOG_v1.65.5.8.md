# Pixly 变更日志 v1.65.5.8

**发布日期**: 2025-01-24

## 🔧 修复 (Bug Fixes)

### 路径验证逻辑修复
- **问题描述**: `ValidatePath` 方法中的路径验证逻辑存在严重缺陷，当路径不存在、不是目录或不在白名单中时，错误地将 `nil` 传递给 `ErrorHandler.WrapError` 方法，导致即使验证失败也返回 `nil`，使得安全检查失效。

- **修复内容**:
  - 修复 `pkg/converter/path_security.go` 中 `ValidatePath` 方法的路径存在性检查
  - 修复 `checkBlacklist` 方法中的黑名单检查错误处理
  - 修复 `checkWhitelist` 方法中的白名单检查错误处理
  - 将所有错误处理从 `psc.errorHandler.WrapError(nil, ...)` 改为直接使用 `fmt.Errorf(...)`

- **影响范围**: 路径安全验证功能
- **测试验证**: 所有 `TestPathWhitelistAndPermissions` 测试用例现在正确通过

## 🧪 测试改进 (Test Improvements)

- **路径安全测试**: 验证了以下场景的正确处理:
  - 白名单目录访问 ✅
  - 禁止目录访问拒绝 ✅
  - 白名单子目录访问 ✅
  - 不存在目录访问拒绝 ✅
  - 文件路径（非目录）访问拒绝 ✅

## 🔒 安全性增强 (Security Enhancements)

- **路径验证强化**: 现在能够正确拒绝对不安全路径的访问
- **错误处理改进**: 确保所有路径验证错误都能被正确捕获和处理
- **防护机制**: 加强了对系统敏感目录的保护

## 📊 技术细节 (Technical Details)

### 修改的文件
- `pkg/converter/path_security.go`: 核心路径验证逻辑修复
- `main.go`: 版本号更新至 v1.65.5.8
- `cmd/root.go`: 版本常量更新

### 代码质量
- **错误处理**: 统一使用 `fmt.Errorf` 创建错误，避免 `nil` 错误传递
- **日志记录**: 保持了详细的调试日志用于问题追踪
- **测试覆盖**: 所有路径验证场景都有对应的测试用例

## 🚀 性能影响 (Performance Impact)

- **无性能影响**: 此次修复仅涉及错误处理逻辑，不影响正常路径的处理性能
- **安全性提升**: 在不影响性能的前提下显著提升了路径验证的可靠性

## 🔄 向后兼容性 (Backward Compatibility)

- **完全兼容**: 此次修复不影响现有功能的使用方式
- **行为改进**: 之前错误通过的不安全路径现在会被正确拒绝（这是预期的安全改进）

## 📝 开发者注意事项 (Developer Notes)

- **错误处理模式**: 在路径验证中，应直接创建错误而不是传递 `nil` 给 `WrapError`
- **测试重要性**: 此次修复突出了全面测试路径验证逻辑的重要性
- **安全优先**: 路径验证是安全的第一道防线，必须确保其正确性

---

**版本**: v1.65.5.8  
**构建时间**: 2025-01-24  
**Git 提交**: [待更新]  
**维护者**: Pixly 开发团队