# Pixly v4.0 - å¤šè¯­è¨€æ”¯æŒç³»ç»ŸæŒ‡å—

**ç‰ˆæœ¬**: v4.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-25  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
3. [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
4. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
5. [APIå‚è€ƒ](#apiå‚è€ƒ)
6. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ç³»ç»Ÿæ¦‚è¿°

### ğŸ¯ ç›®æ ‡

ä¸ºPixlyæä¾›å®Œæ•´çš„å¤šè¯­è¨€æ”¯æŒï¼Œæ”¯æŒç®€ä½“ä¸­æ–‡å’ŒEnglishåŒè¯­ç•Œé¢ï¼Œæå‡å›½é™…ç”¨æˆ·ä½“éªŒã€‚

### âœ¨ ç‰¹æ€§

- **åŒè¯­æ”¯æŒ**: ç®€ä½“ä¸­æ–‡ï¼ˆzh-CNï¼‰å’ŒEnglishï¼ˆen-USï¼‰
- **è‡ªåŠ¨æ£€æµ‹**: æ ¹æ®ç³»ç»Ÿç¯å¢ƒè‡ªåŠ¨é€‰æ‹©è¯­è¨€
- **åŠ¨æ€åˆ‡æ¢**: è¿è¡Œæ—¶æ— éœ€é‡å¯å³å¯åˆ‡æ¢è¯­è¨€
- **å ä½ç¬¦æ”¯æŒ**: æ”¯æŒ{0}, {1}ç­‰å‚æ•°å ä½ç¬¦
- **å›é€€æœºåˆ¶**: ç¿»è¯‘ç¼ºå¤±æ—¶è‡ªåŠ¨å›é€€åˆ°é»˜è®¤è¯­è¨€
- **æ˜“äºæ‰©å±•**: ä¾¿äºæ·»åŠ æ–°è¯­è¨€åŒ…

---

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä½¿ç”¨

```go
import "pixly/pkg/i18n"

// åˆå§‹åŒ–ï¼ˆè‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿè¯­è¨€ï¼‰
func main() {
    i18n.Init(i18n.ZhCN)
    
    // ç¿»è¯‘æ¶ˆæ¯
    fmt.Println(i18n.T(i18n.MsgWelcome))
    // è¾“å‡º: æ¬¢è¿ä½¿ç”¨Pixlyå›¾åƒè½¬æ¢å·¥å…·
    
    // å¸¦å‚æ•°çš„ç¿»è¯‘
    fmt.Println(i18n.T(i18n.MsgProgress, "75%"))
    // è¾“å‡º: è¿›åº¦: 75%
}
```

### è‡ªåŠ¨æ£€æµ‹è¯­è¨€

```go
// åˆ›å»ºç®¡ç†å™¨ï¼ˆè‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿè¯­è¨€ï¼‰
mgr := i18n.NewManager()
locale := mgr.AutoDetectAndSet()

fmt.Printf("Detected locale: %s\n", locale)
fmt.Println(mgr.T(i18n.MsgWelcome))
```

### æ‰‹åŠ¨åˆ‡æ¢è¯­è¨€

```go
// åˆ‡æ¢åˆ°è‹±æ–‡
i18n.SetLocale(i18n.EnUS)
fmt.Println(i18n.T(i18n.MsgWelcome))
// è¾“å‡º: Welcome to Pixly Image Converter

// åˆ‡æ¢åˆ°ä¸­æ–‡
i18n.SetLocale(i18n.ZhCN)
fmt.Println(i18n.T(i18n.MsgWelcome))
// è¾“å‡º: æ¬¢è¿ä½¿ç”¨Pixlyå›¾åƒè½¬æ¢å·¥å…·
```

---

## æ ¸å¿ƒåŠŸèƒ½

### 1ï¸âƒ£ è¯­è¨€è‡ªåŠ¨æ£€æµ‹

æ£€æµ‹ä¼˜å…ˆçº§ï¼š
1. ç¯å¢ƒå˜é‡ `PIXLY_LANG`
2. ç¯å¢ƒå˜é‡ `LANG`
3. ç¯å¢ƒå˜é‡ `LC_ALL`
4. é»˜è®¤å€¼ï¼ˆzh-CNï¼‰

```bash
# é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®è¯­è¨€
export PIXLY_LANG=en-US
./pixly convert images/

# æˆ–
export LANG=zh_CN.UTF-8
./pixly convert images/
```

### 2ï¸âƒ£ æ¶ˆæ¯åˆ†ç±»

#### é€šç”¨æ¶ˆæ¯
- æ¬¢è¿ã€å¯åŠ¨ã€å®Œæˆã€è¿›åº¦ç­‰

#### æ–‡ä»¶æ“ä½œ
- æ‰«ææ–‡ä»¶ã€å¤„ç†æ–‡ä»¶ã€æ–‡ä»¶å®Œæˆ/å¤±è´¥/è·³è¿‡

#### è½¬æ¢ç›¸å…³
- è½¬æ¢å¼€å§‹/å®Œæˆã€ç©ºé—´èŠ‚çœã€è´¨é‡åˆ†æ

#### ä¼šè¯ç®¡ç†
- åˆ›å»º/åŠ è½½/å®Œæˆ/æ¢å¤ä¼šè¯

#### é”™è¯¯æ¶ˆæ¯
- æ–‡ä»¶ä¸å­˜åœ¨ã€æƒé™ä¸è¶³ã€ç£ç›˜æ»¡ã€æ ¼å¼æ— æ•ˆç­‰

#### ç»Ÿè®¡ä¿¡æ¯
- æ€»æ–‡ä»¶æ•°ã€å·²å¤„ç†ã€æˆåŠŸã€å¤±è´¥ã€è·³è¿‡ç­‰

### 3ï¸âƒ£ å ä½ç¬¦æ›¿æ¢

æ”¯æŒ `{0}`, `{1}`, ... `{n}` å ä½ç¬¦ï¼š

```go
// å•ä¸ªå‚æ•°
i18n.T(i18n.MsgProcessingFile, "photo.jpg")
// ä¸­æ–‡: æ­£åœ¨å¤„ç†: photo.jpg
// è‹±æ–‡: Processing: photo.jpg

// å¤šä¸ªå‚æ•°
i18n.T(i18n.MsgSpaceSaved, "65", "10MB", "3.5MB")
// ä¸­æ–‡: èŠ‚çœç©ºé—´: 65% (10MB â†’ 3.5MB)
// è‹±æ–‡: Space saved: 65% (10MB â†’ 3.5MB)
```

---

## ä½¿ç”¨æŒ‡å—

### CLIé›†æˆ

#### æ·»åŠ è¯­è¨€å‚æ•°

```go
// main.go
import (
    "flag"
    "pixly/pkg/i18n"
)

var (
    langFlag = flag.String("lang", "", "Interface language (zh-CN, en-US)")
)

func main() {
    flag.Parse()
    
    // è®¾ç½®è¯­è¨€
    var locale i18n.Locale
    if *langFlag != "" {
        locale = i18n.ParseLocaleString(*langFlag)
    } else {
        // è‡ªåŠ¨æ£€æµ‹
        mgr := i18n.NewManager()
        locale = mgr.AutoDetectAndSet()
    }
    
    i18n.Init(locale)
    
    // ä½¿ç”¨ç¿»è¯‘
    fmt.Println(i18n.T(i18n.MsgWelcome))
}
```

#### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# ä½¿ç”¨ä¸­æ–‡ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰
./pixly convert images/

# æ˜ç¡®æŒ‡å®šè‹±æ–‡
./pixly convert images/ --lang en-US

# æ˜ç¡®æŒ‡å®šä¸­æ–‡
./pixly convert images/ --lang zh-CN
```

### é…ç½®æ–‡ä»¶é›†æˆ

```go
// åœ¨é…ç½®ä¸­æ·»åŠ è¯­è¨€é€‰é¡¹
type Config struct {
    Language string `yaml:"language"`
}

func loadConfig(path string) (*Config, error) {
    // è¯»å–é…ç½®...
    config := &Config{}
    
    // è®¾ç½®è¯­è¨€
    if config.Language != "" {
        locale := i18n.ParseLocaleString(config.Language)
        if i18n.IsValidLocale(locale) {
            i18n.SetLocale(locale)
        }
    }
    
    return config, nil
}
```

### äº¤äº’å¼UI

```go
func interactiveMode() {
    // æ˜¾ç¤ºæ¨ªå¹…
    fmt.Println("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
    fmt.Println("â•‘                                       â•‘")
    fmt.Printf("â•‘   %s   â•‘\n", i18n.T(MsgWelcome))
    fmt.Println("â•‘                                       â•‘")
    fmt.Println("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
    
    // æç¤º
    fmt.Println(i18n.T("hint.drag_drop"))
    fmt.Println(i18n.T("hint.ctrl_c"))
    
    // è¯¢é—®ç”¨æˆ·
    fmt.Print(i18n.T("confirm.continue"))
    
    var response string
    fmt.Scanln(&response)
}
```

### è¿›åº¦æ˜¾ç¤º

```go
func showProgress(current, total int, fileName string) {
    percent := float64(current) / float64(total) * 100
    
    // æ˜¾ç¤ºæ–‡ä»¶å¤„ç†
    fmt.Println(i18n.T(i18n.MsgProcessingFile, fileName))
    
    // æ˜¾ç¤ºè¿›åº¦
    fmt.Println(i18n.T(i18n.MsgProgress, 
        fmt.Sprintf("%.1f%%", percent)))
}
```

### é”™è¯¯å¤„ç†

```go
func handleError(err error, filePath string) {
    var msg string
    
    if os.IsNotExist(err) {
        msg = i18n.T(i18n.ErrFileNotFound, filePath)
    } else if os.IsPermission(err) {
        msg = i18n.T(i18n.ErrPermissionDenied, filePath)
    } else {
        msg = i18n.T(i18n.ErrConversionFailed, err.Error())
    }
    
    fmt.Println(msg)
}
```

---

## APIå‚è€ƒ

### æ ¸å¿ƒå‡½æ•°

```go
// åˆå§‹åŒ–ï¼ˆè®¾ç½®é»˜è®¤è¯­è¨€ï¼‰
func Init(locale Locale)

// ç¿»è¯‘æ¶ˆæ¯
func T(key string, args ...interface{}) string

// è®¾ç½®è¯­è¨€
func SetLocale(locale Locale)

// è·å–å½“å‰è¯­è¨€
func GetLocale() Locale

// è·å–ç¿»è¯‘å™¨
func GetTranslator() *Translator
```

### Manager

```go
// åˆ›å»ºç®¡ç†å™¨ï¼ˆè‡ªåŠ¨æ£€æµ‹è¯­è¨€ï¼‰
func NewManager() *Manager

// è‡ªåŠ¨æ£€æµ‹å¹¶è®¾ç½®è¯­è¨€
func (m *Manager) AutoDetectAndSet() Locale

// è®¾ç½®è¯­è¨€
func (m *Manager) SetLocale(locale Locale)

// è·å–å½“å‰è¯­è¨€
func (m *Manager) GetLocale() Locale

// ç¿»è¯‘æ¶ˆæ¯
func (m *Manager) T(key string, args ...interface{}) string
```

### Translator

```go
// åˆ›å»ºç¿»è¯‘å™¨
func NewTranslator(locale Locale) *Translator

// åŠ è½½è¯­è¨€åŒ…
func (t *Translator) LoadMessages(locale Locale, messages map[string]string)

// è®¾ç½®è¯­è¨€
func (t *Translator) SetLocale(locale Locale)

// ç¿»è¯‘æ¶ˆæ¯
func (t *Translator) T(key string, args ...interface{}) string
```

### å·¥å…·å‡½æ•°

```go
// è§£æè¯­è¨€å­—ç¬¦ä¸²
func ParseLocaleString(s string) Locale

// è·å–æ‰€æœ‰å¯ç”¨è¯­è¨€
func GetAvailableLocales() []Locale

// æ£€æŸ¥è¯­è¨€æ˜¯å¦æœ‰æ•ˆ
func IsValidLocale(locale Locale) bool
```

### å¸¸é‡

```go
// è¯­è¨€ä»£ç 
const (
    ZhCN Locale = "zh-CN" // ç®€ä½“ä¸­æ–‡
    EnUS Locale = "en-US" // English
)

// æ¶ˆæ¯é”®ï¼ˆéƒ¨åˆ†åˆ—è¡¨ï¼‰
const (
    MsgWelcome          = "msg.welcome"
    MsgStarting         = "msg.starting"
    MsgCompleted        = "msg.completed"
    MsgProcessingFile   = "msg.processing_file"
    MsgFileCompleted    = "msg.file_completed"
    ErrFileNotFound     = "err.file_not_found"
    ErrPermissionDenied = "err.permission_denied"
    StatTotalFiles      = "stat.total_files"
    StatProcessed       = "stat.processed"
    // ... æ›´å¤š
)
```

---

## æœ€ä½³å®è·µ

### 1. æ¶ˆæ¯é”®å‘½åè§„èŒƒ

```go
// âœ… æ¨èï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„åˆ†ç±»å‰ç¼€
const (
    MsgWelcome      = "msg.welcome"      // æ¶ˆæ¯
    ErrFileNotFound = "err.file_not_found" // é”™è¯¯
    StatTotalFiles  = "stat.total_files"  // ç»Ÿè®¡
    CfgLanguage     = "cfg.language"      // é…ç½®
)

// âŒ ä¸æ¨èï¼šæ— æ„ä¹‰çš„å‘½å
const (
    Key1 = "k1"
    Key2 = "k2"
)
```

### 2. å ä½ç¬¦ä½¿ç”¨

```go
// âœ… æ¨èï¼šä½¿ç”¨æ•°å­—å ä½ç¬¦
i18n.T("msg.conversion", "jpg", "jxl")
// ä¸­æ–‡: "è½¬æ¢ {0} åˆ° {1}"
// è‹±æ–‡: "Converting {0} to {1}"

// âŒ ä¸æ¨èï¼šä½¿ç”¨å‘½åå ä½ç¬¦ï¼ˆä¸æ”¯æŒï¼‰
// "Converting {source} to {target}" // ä¸æ”¯æŒ
```

### 3. ç¿»è¯‘ä¸€è‡´æ€§

```go
// âœ… æ¨èï¼šæ‰€æœ‰ç”¨æˆ·å¯è§æ–‡æœ¬éƒ½ä½¿ç”¨ç¿»è¯‘
fmt.Println(i18n.T(i18n.MsgWelcome))
fmt.Println(i18n.T(i18n.MsgProgress, "75%"))

// âŒ ä¸æ¨èï¼šç¡¬ç¼–ç æ–‡æœ¬
fmt.Println("Welcome to Pixly")
fmt.Println("Progress: 75%")
```

### 4. é»˜è®¤è¯­è¨€

```go
// âœ… æ¨èï¼šæ€»æ˜¯åˆå§‹åŒ–é»˜è®¤è¯­è¨€
func main() {
    // è‡ªåŠ¨æ£€æµ‹æˆ–ä½¿ç”¨é»˜è®¤
    mgr := i18n.NewManager()
    mgr.AutoDetectAndSet()
    
    // å…¶ä»–ä»£ç ...
}

// âŒ ä¸æ¨èï¼šä¸åˆå§‹åŒ–ï¼ˆä¼šä½¿ç”¨å†…éƒ¨é»˜è®¤ï¼‰
func main() {
    // ç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½å‡ºç°æ„å¤–
    fmt.Println(i18n.T(i18n.MsgWelcome))
}
```

### 5. é”™è¯¯æ¶ˆæ¯å›½é™…åŒ–

```go
// âœ… æ¨èï¼šæ‰€æœ‰é”™è¯¯æ¶ˆæ¯éƒ½ç¿»è¯‘
return fmt.Errorf(i18n.T(i18n.ErrFileNotFound, path))

// âŒ ä¸æ¨èï¼šè‹±æ–‡ç¡¬ç¼–ç é”™è¯¯
return fmt.Errorf("file not found: %s", path)
```

---

## æ‰©å±•æ–°è¯­è¨€

### æ·»åŠ æ–°è¯­è¨€åŒ…

```go
// 1. æ·»åŠ è¯­è¨€å¸¸é‡
const (
    JaJP Locale = "ja-JP" // æ—¥æœ¬èª
)

// 2. åˆ›å»ºè¯­è¨€åŒ…å‡½æ•°
func getJaJPMessages() map[string]string {
    return map[string]string{
        MsgWelcome: "Pixlyã¸ã‚ˆã†ã“ã",
        // ... æ›´å¤šç¿»è¯‘
    }
}

// 3. åœ¨NewTranslatorä¸­åŠ è½½
func NewTranslator(locale Locale) *Translator {
    // ... existing code ...
    t.LoadMessages(JaJP, getJaJPMessages())
    return t
}

// 4. æ›´æ–°parseLocale
func parseLocale(lang string) Locale {
    // ... existing code ...
    
    if strings.Contains(lang, "ja") ||
       strings.Contains(lang, "japanese") {
        return JaJP
    }
    
    return ZhCN
}
```

---

## æ€§èƒ½è€ƒè™‘

### ç¿»è¯‘æ€§èƒ½

- ç¿»è¯‘æŸ¥æ‰¾: O(1)ï¼ˆå“ˆå¸Œè¡¨ï¼‰
- å ä½ç¬¦æ›¿æ¢: O(n)ï¼ˆnä¸ºå‚æ•°æ•°é‡ï¼‰
- è¯­è¨€åˆ‡æ¢: O(1)

### å†…å­˜ä½¿ç”¨

- æ¯ä¸ªè¯­è¨€åŒ…: ~50KB
- ä¸¤ä¸ªè¯­è¨€åŒ…æ€»è®¡: ~100KB
- å¯å¿½ç•¥çš„å†…å­˜å¼€é”€

---

## FAQ

### Q: å¦‚ä½•æ·»åŠ æ–°çš„ç¿»è¯‘å­—ç¬¦ä¸²ï¼Ÿ

A: 
1. åœ¨ `i18n.go` ä¸­æ·»åŠ å¸¸é‡
2. åœ¨ `locale_zh.go` ä¸­æ·»åŠ ä¸­æ–‡ç¿»è¯‘
3. åœ¨ `locale_en.go` ä¸­æ·»åŠ è‹±æ–‡ç¿»è¯‘

### Q: ç¿»è¯‘ç¼ºå¤±ä¼šæ€æ ·ï¼Ÿ

A: è¿”å›æ¶ˆæ¯é”®æœ¬èº«ï¼Œä¸ä¼šå´©æºƒã€‚

### Q: æ”¯æŒè¿è¡Œæ—¶åˆ‡æ¢è¯­è¨€å—ï¼Ÿ

A: æ”¯æŒï¼Œè°ƒç”¨ `SetLocale()` å³å¯ã€‚

### Q: å¦‚ä½•æ£€æµ‹ç”¨æˆ·çš„ç³»ç»Ÿè¯­è¨€ï¼Ÿ

A: ä½¿ç”¨ `NewManager()` ä¼šè‡ªåŠ¨æ£€æµ‹ã€‚

### Q: æ€§èƒ½å½±å“å¤§å—ï¼Ÿ

A: å‡ ä¹æ²¡æœ‰ï¼Œå•æ¬¡ç¿»è¯‘ <1Î¼sã€‚

---

## æ€»ç»“

å¤šè¯­è¨€æ”¯æŒç³»ç»Ÿæä¾›ï¼š

âœ… **åŒè¯­ç•Œé¢**: ä¸­æ–‡å’Œè‹±æ–‡  
âœ… **è‡ªåŠ¨æ£€æµ‹**: æ™ºèƒ½è¯­è¨€è¯†åˆ«  
âœ… **æ˜“äºä½¿ç”¨**: ç®€æ´çš„API  
âœ… **æ˜“äºæ‰©å±•**: ä¾¿äºæ·»åŠ æ–°è¯­è¨€  
âœ… **é«˜æ€§èƒ½**: é›¶å¼€é”€ç¿»è¯‘  

---

**ç‰ˆæœ¬**: v4.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-25  
**ä½œè€…**: Pixly Team
