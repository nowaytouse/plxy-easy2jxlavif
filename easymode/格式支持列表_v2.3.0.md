# 格式支持列表 v2.3.0

## Media_tools - XMP合并支持格式

### 📷 标准图片格式（12种）
| 格式 | 扩展名 | 说明 | ExifTool支持 |
|------|--------|------|-------------|
| JPEG | .jpg, .jpeg | 最常见的图片格式 | ✅ 完全支持 |
| PNG | .png | 无损压缩图片 | ✅ 完全支持 |
| GIF | .gif | 动画图片 | ✅ 完全支持 |
| BMP | .bmp | 位图 | ✅ 完全支持 |
| TIFF | .tiff, .tif | 高质量图片 | ✅ 完全支持 |
| WebP | .webp | Google格式 | ✅ 完全支持 |

### 🎨 现代图片格式（4种）
| 格式 | 扩展名 | 说明 | ExifTool支持 |
|------|--------|------|-------------|
| JPEG XL | .jxl | 次世代格式 | ✅ 完全支持 |
| AVIF | .avif | AV1图片 | ✅ 完全支持 |
| HEIC | .heic, .heif | Apple格式 | ✅ 完全支持 |

### 🎯 专业格式（2种）- v2.3.0新增
| 格式 | 扩展名 | 说明 | ExifTool支持 |
|------|--------|------|-------------|
| Photoshop | .psd | Photoshop文档 | ✅ 支持（可能较慢）|
| Large Photoshop | .psb | 大型PSD | ✅ 支持（可能较慢）|

### 📸 相机RAW格式（8种）- v2.3.0新增
| 格式 | 扩展名 | 相机品牌 | ExifTool支持 |
|------|--------|----------|-------------|
| Canon RAW | .cr2 | Canon（旧） | ✅ 完全支持 |
| Canon RAW | .cr3 | Canon（新） | ✅ 完全支持 |
| Nikon RAW | .nef | Nikon | ✅ 完全支持 |
| Sony RAW | .arw | Sony | ✅ 完全支持 |
| Adobe DNG | .dng | 通用RAW | ✅ 完全支持 |
| Fujifilm RAW | .raf | Fujifilm | ✅ 完全支持 |
| Olympus RAW | .orf | Olympus | ✅ 完全支持 |
| Panasonic RAW | .rw2 | Panasonic | ✅ 完全支持 |

### 🎬 视频格式（4种）
| 格式 | 扩展名 | 说明 | ExifTool支持 |
|------|--------|------|-------------|
| MP4 | .mp4 | 最常见视频 | ✅ 完全支持 |
| QuickTime | .mov | Apple视频 | ✅ 完全支持 |
| AVI | .avi | 旧版视频 | ✅ 完全支持 |
| Matroska | .mkv | 开源容器 | ✅ 完全支持 |

---

## 📊 总计

| 类别 | v2.2.0 | v2.3.0 | 新增 |
|------|--------|--------|------|
| 标准图片 | 12 | 12 | - |
| 现代格式 | 4 | 4 | - |
| 专业格式 | 0 | 2 | +2 |
| RAW格式 | 0 | 8 | +8 |
| 视频格式 | 4 | 4 | - |
| **总计** | **18** | **26** | **+8** |

---

## Universal_converter - 转换支持格式

### 输入格式

#### JXL转换模式（-type jxl）
| 格式 | 支持 | 转换方式 | Live Photo |
|------|------|----------|-----------|
| JPG/JPEG | ✅ | 直接转换（无损JPEG） | - |
| PNG | ✅ | 直接转换（-d 0） | - |
| GIF | ✅ | 直接转换（保留动画） | - |
| WebP | ✅ | 直接转换 | - |
| BMP | ✅ | 直接转换 | - |
| TIFF | ✅ | 直接转换 | - |
| HEIC/HEIF | ✅ | 中间格式转换 | ✅ v2.3.0跳过 |
| AVIF | ✅ | 中间格式转换 | - |

#### MOV转换模式（-type mov）
| 格式 | 支持 | 转换方式 |
|------|------|----------|
| MP4 | ✅ | FFmpeg重封装 |
| AVI | ✅ | FFmpeg重封装 |
| MKV | ✅ | FFmpeg重封装 |
| WebM | ✅ | FFmpeg重封装 |

---

## 🆕 v2.3.0 新增功能详解

### Apple Live Photo 处理

**什么是Live Photo？**
- HEIC静态照片 + MOV短视频的组合
- 文件命名: `IMG_0001.heic` + `IMG_0001.mov`
- iOS设备拍摄的3秒动态照片

**v2.3.0 处理策略**：
```
检测到配对 → 跳过HEIC转换 → 保留原始配对
未检测配对 → 正常转换HEIC → 生成JXL
```

**日志输出**：
```
🏞️  检测到Apple Live Photo，跳过转换: IMG_0001.heic
✅ 识别为支持格式: IMG_0002.heic (heic)
```

### PSD/PSB XMP合并

**支持的操作**：
- 读取 `.psd.xmp` 侧边文件
- 合并元数据到 `.psd` 文件
- 删除 XMP 侧边文件
- 保留图层和通道信息

**注意事项**：
- PSD 文件可能很大（>1GB）
- 合并时间可能较长
- 建议先小文件测试

### RAW格式 XMP合并

**支持的相机品牌**：
- Canon (CR2, CR3)
- Nikon (NEF)
- Sony (ARW)
- Fujifilm (RAF)
- Olympus (ORF)
- Panasonic (RW2)
- Adobe DNG (通用)

**XMP 对于 RAW 的重要性**：
- RAW 文件包含原始传感器数据
- XMP 包含编辑参数（曝光、色彩等）
- 合并后保留完整的编辑历史

---

## 💡 使用建议

### 处理顺序推荐

对于包含多种格式的目录：

```bash
# 步骤1: 合并所有XMP（包括PSD和RAW）
media_tools merge -dir /path/to/files

# 步骤2: 转换图片为JXL（自动跳过Live Photo）
universal_converter -input /path/to/files -type jxl -quality 90

# 步骤3: 转换视频为MOV
universal_converter -input /path/to/files -type mov
```

### 特殊格式处理

**PSD 文件**：
- 如果只需要合并XMP，使用 media_tools
- 如果需要转换格式，请先在Photoshop中导出

**RAW 文件**：
- 建议保留RAW文件原始状态
- 仅合并XMP，不转换格式
- 如需要转换，先在专业软件中处理

**Live Photo**：
- 推荐保留原始配对
- 如需要单独的照片，手动分离

---

## 📞 技术支持

### 依赖检查

```bash
# 检查 ExifTool（必需）
which exiftool
exiftool -ver

# 检查 cjxl（JXL转换必需）
which cjxl

# 检查 FFmpeg（视频转换必需）
which ffmpeg
```

### 常见问题

**Q: PSD 合并XMP失败？**
A: 检查文件权限，确保 PSD 文件可写

**Q: RAW 文件合并后无法在相机软件中打开？**
A: 这是正常的，相机软件可能不认可修改后的 RAW

**Q: Live Photo 检测不工作？**
A: 确认 HEIC 和 MOV 文件名完全一致（除扩展名外）

---

**更新日期**: 2025年10月24日  
**版本**: v2.3.0  
**向后兼容**: 是
