# Easymode 工具更新说明 v2.3.0

**更新日期**: 2025年10月24日  
**更新类型**: 功能增强

---

## 📦 更新的工具

### 1. universal_converter v2.3.0

**位置**: `easymode/universal_converter/bin/universal_converter`

#### 🆕 新增功能

✅ **Apple Live Photo 智能跳过**
- 自动检测 HEIC/HEIF + MOV 配对文件
- 跳过Live Photo的静态部分转换
- 保留原始Live Photo完整性
- 避免Live Photo关联丢失

#### 🔧 技术实现

使用 `utils.IsLivePhoto()` 函数检测：
```go
// 检测逻辑
if utils.IsLivePhoto(filePath) {
    logger.Printf("🏞️  检测到Apple Live Photo，跳过转换")
    return "" // 跳过处理
}
```

检测条件：
- 文件扩展名为 `.heic` 或 `.heif`
- 存在同名的 `.mov` 文件
- 例如: `IMG_0001.heic` + `IMG_0001.mov`

#### 📋 影响范围

**转换行为变化**：

之前版本：
```
IMG_0001.heic → IMG_0001.jxl (静态)
IMG_0001.mov → IMG_0001.mov (重封装)
结果：Live Photo关联丢失
```

新版本 v2.3.0：
```
IMG_0001.heic → 跳过转换
IMG_0001.mov → IMG_0001.mov (重封装)
结果：保留Live Photo配对
```

---

### 2. media_tools v2.3.0

**位置**: `easymode/media_tools/bin/media_tools`

#### 🆕 新增格式支持

✅ **Photoshop 格式**
- `.psd` - Photoshop 文档
- `.psb` - 大型 Photoshop 文档

✅ **相机 RAW 格式（8种）**
- `.cr2` - Canon RAW (旧版)
- `.cr3` - Canon RAW (新版)
- `.nef` - Nikon RAW
- `.arw` - Sony RAW
- `.dng` - Adobe DNG (通用RAW)
- `.raf` - Fujifilm RAW
- `.orf` - Olympus RAW
- `.rw2` - Panasonic RAW

#### 📊 支持格式统计

**图片格式**: 22种
- 标准格式: JPG, PNG, GIF, BMP, TIFF, WebP
- 现代格式: JXL, AVIF, HEIC, HEIF
- 专业格式: PSD, PSB
- RAW格式: CR2, CR3, NEF, ARW, DNG, RAF, ORF, RW2

**视频格式**: 4种
- MP4, MOV, AVI, MKV

**总计**: 26种文件格式！

#### 🔧 修改位置

1. `findMediaFile()` 函数 (第206行)
2. `isMediaFile()` 函数 (第272行)
3. `scanMediaFiles()` 函数 (第441行)

---

## �� 使用示例

### Universal_converter v2.3.0

```bash
# Live Photo会被自动跳过
cd easymode/universal_converter
./bin/universal_converter -input /path/to/photos -type jxl -quality 90

# 输出示例:
# 🏞️  检测到Apple Live Photo，跳过转换: IMG_0001.heic
# ✅ 识别为支持格式: IMG_0002.heic (heic)
```

### Media_tools v2.3.0

```bash
# 现在支持PSD和RAW格式的XMP合并
cd easymode/media_tools
./bin/media_tools merge -dir /path/to/files

# 支持的XMP配对示例:
# photo.psd + photo.psd.xmp ✅
# raw.cr3 + raw.cr3.xmp ✅
# image.nef + image.nef.xmp ✅
```

---

## 🔄 升级方法

### 方法1: 直接使用（推荐）

新版本已编译在 `bin/` 目录，直接使用即可：
```bash
easymode/universal_converter/bin/universal_converter
easymode/media_tools/bin/media_tools
```

### 方法2: 从源码重新编译

```bash
# Universal_converter
cd easymode/universal_converter
go build -o bin/universal_converter main.go

# Media_tools
cd easymode/media_tools
go build -o bin/media_tools main.go
```

---

## ⚠️ 注意事项

### Universal_converter

1. **Live Photo 检测**：
   - 仅当 HEIC/HEIF 文件存在同名 MOV 文件时才跳过
   - 普通 HEIC 文件仍会正常转换
   - 不影响其他格式

2. **向后兼容**：
   - 所有原有功能保持不变
   - 仅新增 Live Photo 跳过逻辑

### Media_tools

1. **PSD/PSB 支持**：
   - ExifTool 理论上支持 PSD 元数据
   - 复杂的 PSD 文件可能合并较慢
   - 建议先测试小文件

2. **RAW 格式支持**：
   - 支持主流相机品牌的 RAW 格式
   - XMP 是 RAW 文件的标准元数据格式
   - 合并后元数据嵌入到 RAW 文件中

3. **兼容性**：
   - 所有原有格式继续支持
   - 新增格式不影响现有功能

---

## 📊 版本对比

| 功能 | v2.2.0 | v2.3.0 |
|------|--------|--------|
| **Universal_converter** | | |
| Live Photo 检测 | ❌ | ✅ |
| HEIC 转换 | 全部转换 | 跳过Live Photo |
| **Media_tools** | | |
| 支持格式数 | 18种 | 26种 |
| PSD/PSB | ❌ | ✅ |
| RAW 格式 | ❌ | ✅ (8种) |

---

## �� 升级建议

**立即升级**，如果你：
- ✅ 有 Apple Live Photo 需要处理
- ✅ 有 PSD/PSB 文件需要合并 XMP
- ✅ 有相机 RAW 文件需要合并 XMP

**可选升级**，如果你：
- 没有上述特殊格式文件
- 当前版本运行正常

---

## 📞 技术支持

如遇问题，请检查：
1. Go 版本 >= 1.19
2. ExifTool 已安装
3. 文件权限正确

---

**备份说明**: 
- 原版本已备份为 `main.go.backup`
- 可随时恢复到旧版本

**编译时间**: 2025年10月24日 03:22
